<center> <h1>
    OAuth 2.0 授权框架
    </h1> </center>

* **角色**
* **协议流程**
* **授权许可**
* **访问令牌**
* **刷新令牌**

### 角色

**OAuth 2.0 定义了4种角色**

* **资源所有者**

  能够许可受保护资源访问权限的实体，当资源所有者是个人时，它作为最终用户被提及

* **资源服务器**

  托管受保护资源的服务器，能够接受和响应使用token 访问受保护的资源的请求

* **客户端**

  使用资源所有者的授权对代表授权者对资源服务器发起对受保护资源请求的应用程序，术语“客户端”并非特指

  任何特定的的实现特点（例如：应用程序是否在服务器、台式机或其他设备上执行）

* **授权服务器**

  在成功验证资源所有者且获得授权后颁发访问token给客户端的服务器。授权服务器可以和资源服务器是同一台服务器，也可以是分离的个体。一个授权服务器可以颁发被多个资源服务器接受的访问令牌。

**以我们使用QQ登录CSDN：**

资源所有者：我们

资源服务器：QQ服务器

客户端：CSDN

授权服务器：QQ服务器

### 协议流程

![](C:\Users\gavin\Desktop\spring学习记录\auth2\image-20210711154127774.png)

**图 1 中所示的抽象 OAuth 2.0 流程描述了四个角色之间的交互，包括以下步骤：** 

• （A）客户端向从资源所有者请求授权。授权请求可以直接向资源所有者发起（如图所示），或者更

可取的是通过作为中介的授权服务器间接发起。

• （B）客户端收到授权许可，这是一个代表资源所有者的授权的凭据，使用本规范中定义的四种许可

类型之一或 者使用扩展许可类型表示。授权许可类型取决于客户端请求授权所使用的方式以及授权

服务器支持的类型。

• （C）客户端与授权服务器进行身份认证并出示授权许可请求访问令牌。

• （D）授权服务器验证客户端身份并验证授权许可，若有效则颁发访问令牌。

• （E）客户端从资源服务器请求受保护资源并出示访问令牌进行身份验证。

• （F）资源服务器验证访问令牌，若有效则满足该请求。

### 授权许可

- **授权码**

  授权码通过使用授权服务器做为客户端与资源所有者的中介而获得。客户端不是直接从资源所有者请求

  授权，而是引导资源所有者至授权服务器（由在 RFC2616 中定义的用户代理），授权服务器之后引导资

  源所有者带着授权码回到客户端。

  在引导资源所有者携带授权码返回客户端前，授权服务器会鉴定资源所有者身份并获得其授权。由于资

  源所有者只与授权服务器进行身份验证，所以资源所有者的凭据不需要与客户端分享。

  授权码提供了一些重要的安全益处，例如验证客户端身份的能力，以及向客户端直接的访问令牌的传输

  而非通过资源所有者的用户代理来传送它而潜在暴露给他人（包括资源所有者）。

- **隐式许可**

  隐式许可是为用如 JavaScript 等脚本语言在浏览器中实现的客户端而优化的一种简化的授权码流程。在隐

  式许可流程中，不再给客户端颁发授权码，取而代之的是客户端直接被颁发一个访问令牌（作为资源所

  有者的授权）。这种许可类型是隐式的，因为没有中间凭据（如授权码）被颁发（之后用于获取访问令

  牌）。

  当在隐式许可流程中颁发访问令牌时，发授权服务器不对客户端进行身份验证。在某些情况下，客户端

  身份可以通过用于向客户端传送访问令牌的重定向 URI 验证。访问令牌可能会暴露给资源所有者，或者

  对资源所有者的用户代理有访问权限的其他应用程序。

  隐式许可提高了一些客户端（例如一个作为浏览器内应用实现的客户端）的响应速度和效率，因为它减 

  少了获取访问令牌所需的往返数量。然而，这种便利应该和采用隐式许可的安全影响作权衡，如那些在

  10.3 和 10.16 节中所述的，尤其是当授权码许可类型可用的时候。

- **资源所有者密码凭据**

  资源所有者密码凭据（即用户名和密码），可以直接作为获取访问令牌的授权许可。这种凭据只能应该

  当资源所有者和客户端之间具有高度信任时（例如，客户端是设备的操作系统的一部分，或者是一个高

  度特权应用程序），以及当其他授权许可类型（例如授权码）不可用时被使用。

  尽管本授权类型需要对资源所有者凭据直接的客户端访问权限，但资源所有者凭据仅被用于一次请求并

  被交换为访问令牌。通过凭据和长期有效的访问令牌或刷新令牌的互换，这种许可类型可以消除客户端

  存储资源所有者凭据供将来使用的需要。

- **客户端凭据**

  当授权范围限于客户端控制下的受保护资源或事先与授权服务器商定的受保护资源时客户端凭据可以被

  用作为一种授权许可。典型的当客户端代表自己表演（客户端也是资源所有者）或者基于与授权服务器

  事先商定的授权请求对受保护资源的访问权限时，客户端凭据被用作为授权许可。

###  **刷新令牌**

**访问令牌是用于获取访问令牌的凭据。刷新令牌由授权服务器颁发给客户端，用于在当前访问令牌失效** 

**或过期时，获取一个新的访问令牌，或者获得相等或更窄范围的额外的访问令牌（访问令牌可能具有比**

**资源所有者所授权的更短的生命周期和更少的权限）。颁发刷新令牌是可选的，由授权服务器决定。如**

**果授权服务器颁发刷新令牌，在颁发访问令牌时它被包含在内（即图 1 中的步骤 D）。**

**刷新令牌是一个代表由资源所有者给客户端许可的授权的字符串。该字符串通常对于客户端是不透明的。** 

**该令牌表示一个用于检索授权信息的标识符。不同于访问令牌，刷新令牌设计只与授权服务器使用，并**

**不会发送到资源服务器。**



![](C:\Users\gavin\Desktop\spring学习记录\auth2\image-20210711155122038.png)

**图 2 中的所示流程包含以下步骤：** 

• （A）客户端通过与授权服务器进行身份验证并出示授权许可请求访问令牌。

• （B）授权服务器对客户端进行身份验证并验证授权许可，若有效则颁发访问令牌和刷新令牌。

• （C）客户端通过出示访问令牌向资源服务器发起受保护资源的请求。

• （D）资源服务器验证访问令牌，若有效则满足该要求。

• （E）步骤（C）和（D）重复进行，直到访问令牌到期。如果客户端知道访问令牌已过期，跳到步骤

（G），否 则它将继续发起另一个对受保护资源的请求。

• （F）由于访问令牌是无效的，资源服务器返回无效令牌错误。

• （G）客户端通过与授权服务器进行身份验证并出示刷新令牌，请求一个新的访问令牌。客户端身份

验证要求基于客户端的类型和授权服务器的策略。 

• （H）授权服务器对客户端进行身份验证并验证刷新令牌，若有效则颁发一个新的访问令牌（和——

可选地——一个新的刷新令牌）。

